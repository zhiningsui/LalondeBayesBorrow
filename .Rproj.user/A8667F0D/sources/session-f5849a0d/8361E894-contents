#' Title
#'
#' @param endpoint
#' @param true_value
#' @param post_est_ci
#'
#' @return
#' @export
#'
#' @examples
calc_post_dist_metrics <- function(endpoint, true_value, post_est_ci) {
  if (endpoint == "g-score") {
    # Parameter of interest: delta = log(theta_t/theta_c)
    delta <- log(true_value)

    # Point estimate for each run: delta_hat = log(theta_t_hat) - log(theta_c_hat)
    delta_hat <- log(post_est_ci$est1) - log(post_est_ci$est2)

    # Average Bias of delta_hat
    bias_avg <- mean(delta_hat - delta)

    # Average Bias of estimated median ratio
    bias_avg_median_ratio1 <- exp(mean(delta_hat)) - true_value
    median_ratio_hat <- post_est_ci$est_compare
    bias_avg_median_ratio2 <- mean(median_ratio_hat - true_value)

    # Average SD (i.e., SE) of delta_hat
    sds <- post_est_ci$sd_compare
    sd_avg <- mean(sds)

    # Empirical SD of delta_hat
    sd_empirical <- sd(delta_hat)

    # Coverage probability 95%
    ci <- data.frame(cil = log(post_est_ci$compare_ci_l),
                     ciu = log(post_est_ci$compare_ci_u))
    ci$coverage <- ifelse(ci$cil < delta & ci$ciu > delta, 1, 0)
    cp <- mean(ci$coverage)

    metrics <- data.frame(delta = delta,
                          bias_avg = bias_avg,
                          bias_avg_median_ratio1 = bias_avg_median_ratio1,
                          bias_avg_median_ratio2 = bias_avg_median_ratio2,
                          sd_avg = sd_avg,
                          sd_empirical = sd_empirical,
                          cp = cp)

  } else if (endpoint == "OR") {
    # Parameter of interest: delta = rate_t - rate_c
    delta <- true_value

    # Point estimate for each run: delta_hat = rate_t_hat - rate_c_hat
    delta_hat <- post_est_ci$est_compare

    # Average Bias of estimated rate difference
    bias_avg_rate_diff <- mean(delta_hat - delta)

    # Average SD (i.e., SE) of delta_hat
    sds <- post_est_ci$sd_compare
    sd_avg <- mean(sds)

    # Empirical SD of delta_hat
    sd_empirical <- sd(delta_hat)

    # Coverage probability 95%
    ci <- data.frame(cil = post_est_ci$compare_ci_l,
                     ciu = post_est_ci$compare_ci_u)
    ci$coverage <- ifelse(ci$cil < delta & ci$ciu > delta, 1, 0)
    cp <- mean(ci$coverage)

    metrics <- data.frame(delta = delta,
                          bias_avg_rate_diff = bias_avg_rate_diff,
                          sd_avg = sd_avg,
                          sd_empirical = sd_empirical,
                          cp = cp)
  }

  return(metrics)
}
